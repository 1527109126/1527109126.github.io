<!doctype html>
<html lang="zh"><head>
<title>Vite 使用 br 压缩 - 别调P的小窝</title>
<meta charset="UTF-8">
<meta name="keywords" content="前端,HTML,bietiaop,别调P,别调皮,编程,学习,大学生,博客,CSS,NodeJS,JavaScript,JS,React,Vue,开发,安全,网络空间安全,网安">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

<link rel="shortcut icon" href="https://thirdqq.qlogo.cn/g?b=sdk&amp;k=27Ng6EAub38cF3gdSBSNoA&amp;s=640&amp;t=1654771498" type="image/jpeg" />
<meta name="description" content="为什么使用 br 压缩 gzip 压缩Gzip 是一种用于文件压缩与解压缩的文件格式。它基于 Deflate 算法，可将文件（译者注：快速地、流式地）压缩地更小，从而实现更快的网络传输。Web 服务器与现代浏览器普遍地支持 Gzip，这意味着服务器可以在发送文件之前自动使用 Gzip 压缩文件，而浏览器可以在接收文件时自行解压缩文件。摘自：MDN Web Docs  br 压缩同 gzip 类似，">
<meta property="og:type" content="article">
<meta property="og:title" content="Vite 使用 br 压缩">
<meta property="og:url" content="https://blog.bietiaop.com/2023/06/24/web/front/vite/vite-shi-yong-br-ya-suo/index.html">
<meta property="og:site_name" content="别调P的小窝">
<meta property="og:description" content="为什么使用 br 压缩 gzip 压缩Gzip 是一种用于文件压缩与解压缩的文件格式。它基于 Deflate 算法，可将文件（译者注：快速地、流式地）压缩地更小，从而实现更快的网络传输。Web 服务器与现代浏览器普遍地支持 Gzip，这意味着服务器可以在发送文件之前自动使用 Gzip 压缩文件，而浏览器可以在接收文件时自行解压缩文件。摘自：MDN Web Docs  br 压缩同 gzip 类似，">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-06-24T05:10:38.000Z">
<meta property="article:modified_time" content="2023-06-24T05:10:38.000Z">
<meta property="article:author" content="别调P">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="gzip">
<meta property="article:tag" content="br">
<meta property="article:tag" content="Vite">
<meta property="article:tag" content="Vite插件">
<meta property="article:tag" content="压缩">
<meta name="twitter:card" content="summary">

<link rel="stylesheet" href="/lib/fancybox/fancybox.css">
<link rel="stylesheet" href="/lib/mdui_043tiny/mdui.css">


<link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1730173442647">

<link rel="stylesheet" href="/css/style.css?v=1730173442647">




    
        <link rel="stylesheet" href="/custom.css?v=1730173442647">
    
        <link rel="stylesheet" href="/custom.css?v=1730173442647">
    



<script src="/lib/mdui_043tiny/mdui.js" async></script>
<script src="/lib/fancybox/fancybox.umd.js" async></script>
<script src="/lib/lax.min.js" async></script>


<script async src="/js/app.js?v=1730173442647"></script>

 

<link rel="stylesheet" href="/prism.css">
<link rel="stylesheet" href="/prism-theme.css">
<link rel="stylesheet" href="/custom.css">


<link rel="stylesheet"  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="nexmoe mdui-drawer-body-left"><div id="nexmoe-background"><div class="nexmoe-bg" style="background-image: url(https://pi.loili.com/2023/f6783b98aff068804ef345ecfab907ab.jpg)"></div><div class="mdui-appbar mdui-shadow-0"><div class="mdui-toolbar"><a class="mdui-btn mdui-btn-icon mdui-ripple" mdui-drawer="{target: &#039;#drawer&#039;, swipe: true}" title="menu"><i class="mdui-icon nexmoefont icon-menu"></i></a><div class="mdui-toolbar-spacer"></div><a class="mdui-btn mdui-btn-icon" href="/" title="别调P"><img src="https://thirdqq.qlogo.cn/g?b=sdk&amp;k=27Ng6EAub38cF3gdSBSNoA&amp;s=640&amp;t=1654771498" alt="别调P"></a></div></div></div><div id="nexmoe-header"><div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="别调P">
            <img src="https://thirdqq.qlogo.cn/g?b=sdk&amp;k=27Ng6EAub38cF3gdSBSNoA&amp;s=640&amp;t=1654771498" alt="别调P" alt="别调P">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>14</div>
        <div><span>标签</span>39</div>
        <div><span>分类</span>14</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/works.html" title="我的作品">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                我的作品
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/favorites.html" title="收 藏 夹">
            <i class="mdui-list-item-icon nexmoefont icon-tags-fill"></i>
            <div class="mdui-list-item-content">
                收 藏 夹
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" target="_blank" rel="noopener" href="https://www.bietiaop.com" title="关 于 我">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关 于 我
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/friends.html" title="友情链接">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                友情链接
            </div>
        </a>
        
    </div>
    
    
        
        <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        
            <form id="search_form">
                <label><input class="st-default-search-input" id="search_value" name="q" type="search" placeholder="搜索" style="
                    font-size: 15px !important;
                    height: 56px !important;
                    background-image: none;
                "></label>
            </form>
         
    </div>
</div>


	<script async src="/js/search.js?v=1730173442648"></script>



    
        
        <div class="nexmoe-widget-wrap">
	<div class="nexmoe-widget nexmoe-social">
		<a
			class="mdui-ripple"
			href="https://space.bilibili.com/152308001"
			target="_blank"
			mdui-tooltip="{content: '哔哩哔哩'}"
			style="
				color: rgb(231, 106, 141);
				background-color: rgba(231, 106, 141, .15);
			"
		>
			<i
				class="nexmoefont icon-bilibili"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://github.com/bietiaop/"
			target="_blank"
			mdui-tooltip="{content: 'GitHub'}"
			style="
				color: rgb(25, 23, 23);
				background-color: rgba(25, 23, 23, .15);
			"
		>
			<i
				class="nexmoefont icon-github"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=bietiaop%40bietiaop.com"
			target="_blank"
			mdui-tooltip="{content: 'Email'}"
			style="
				color: rgb(25, 23, 23);
				background-color: rgba(25, 23, 23, .15);
			"
		>
			<i
				class="nexmoefont icon-mail-fill"
			></i> </a
		>
	</div>
</div>

    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Flutter/">Flutter</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Github/">Github</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Rust/">Rust</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Vite/">Vite</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/web/">web</a>
          <span class="category-list-count">8</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/设计/前端/">前端</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/数据库/后端/">后端</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Github/学生认证/">学生认证</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/数据库/">数据库</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Rust/编程/">编程</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/设计/">设计</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


    
        
        
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/Android%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/" style="font-size: 10px;">Android应用开发</a> <a href="/tags/CSS/" style="font-size: 12px;">CSS</a> <a href="/tags/Canvas/" style="font-size: 10px;">Canvas</a> <a href="/tags/Flutter/" style="font-size: 10px;">Flutter</a> <a href="/tags/GetX/" style="font-size: 10px;">GetX</a> <a href="/tags/Github/" style="font-size: 10px;">Github</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/MySql/" style="font-size: 10px;">MySql</a> <a href="/tags/Query/" style="font-size: 10px;">Query</a> <a href="/tags/React/" style="font-size: 16px;">React</a> <a href="/tags/React-Router/" style="font-size: 10px;">React Router</a> <a href="/tags/Redux/" style="font-size: 10px;">Redux</a> <a href="/tags/Rust/" style="font-size: 10px;">Rust</a> <a href="/tags/Vite/" style="font-size: 14px;">Vite</a> <a href="/tags/Vite%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">Vite插件</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/br/" style="font-size: 10px;">br</a> <a href="/tags/gzip/" style="font-size: 10px;">gzip</a> <a href="/tags/iOS%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/" style="font-size: 10px;">iOS应用开发</a> <a href="/tags/web/" style="font-size: 18px;">web</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 20px;">前端</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%AD%97%E4%BD%93/" style="font-size: 10px;">前端字体</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">博客</a> <a href="/tags/%E5%8E%8B%E7%BC%A9/" style="font-size: 10px;">压缩</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 10px;">后端</a> <a href="/tags/%E5%9B%BE%E7%89%87%E6%8A%95%E5%BD%B1/" style="font-size: 10px;">图片投影</a> <a href="/tags/%E5%9B%BE%E7%89%87%E9%98%B4%E5%BD%B1/" style="font-size: 10px;">图片阴影</a> <a href="/tags/%E5%AD%97%E4%BD%93%E5%88%87%E5%89%B2/" style="font-size: 10px;">字体切割</a> <a href="/tags/%E5%AD%A6%E7%94%9F%E8%AE%A4%E8%AF%81/" style="font-size: 10px;">学生认证</a> <a href="/tags/%E5%AE%89%E5%8D%93%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/" style="font-size: 10px;">安卓应用开发</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%9F%A5%E8%AF%A2/" style="font-size: 10px;">查询</a> <a href="/tags/%E7%94%B3%E8%AF%B7%E6%8C%87%E5%8D%97/" style="font-size: 10px;">申请指南</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">编程</a> <a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size: 16px;">网站</a> <a href="/tags/%E7%BD%91%E9%A1%B5/" style="font-size: 16px;">网页</a> <a href="/tags/%E8%AE%BE%E8%AE%A1/" style="font-size: 10px;">设计</a> <a href="/tags/%E9%81%BF%E5%9D%91/" style="font-size: 10px;">避坑</a> <a href="/tags/%E9%85%8D%E8%89%B2/" style="font-size: 10px;">配色</a>
    </div>
    
      <script>
        var maxTagcloud = parseInt(17);
        var tags_length = parseInt(39);
        var tags_arr = [];
        for(var i = 0; i < tags_length; i++){
          tags_arr.push(i);
        }
        tags_arr.sort(function (l, r) {
          return Math.random() > 0.5 ? -1 : 1;
        });
        tags_arr = tags_arr.slice(0, maxTagcloud < tags_length ? tags_length - maxTagcloud : 0);
        for(var tag_i = 0; tag_i < tags_arr.length; tag_i++){
          document.getElementById("randomtagcloud").children[tags_arr[tag_i]].style.display = 'none';
        }
      </script>
    
  </div>

    
        
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">14</span></li></ul>
    </div>
  </div>



    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">最新文章</h3>
    <div class="nexmoe-widget">
      <ul>
        
          <li>
            <a href="/2023/09/06/other/github-education/">Github 学生认证申请指南（2023避坑）</a>
          </li>
        
          <li>
            <a href="/2023/07/24/rust/study/01/">Rust 学习笔记（一）</a>
          </li>
        
          <li>
            <a href="/2023/07/20/web/front/react/canvas-tu-pian-tian-chong-yan-se/">Canvas 使用纯色填充图片</a>
          </li>
        
          <li>
            <a href="/2023/07/10/flutter/getx/getx-xue-xi-ri-zhi/">GetX 学习日志</a>
          </li>
        
          <li>
            <a href="/2023/07/02/web/front/hexo/da-jian-hexo-bo-ke/">Hexo博客搭建</a>
          </li>
        
      </ul>
    </div>
  </div>

    
   
    <div class="nexmoe-copyright">
        &copy; 2024 别调P
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><a target="_blank" href="https://beian.miit.gov.cn/">苏ICP备2022027042号-1</a>
<br><a target="_blank" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral">
<img src="https://i.dawnlab.me/c0268c1e6cfd0863d6ba35be1575941a.png" width="150px"></a>
<!-- <script type="text/javascript" color="0,0,255" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script> -->
<script src="/cursor-effects.js" defer></script>

    </div>
</div><!-- .nexmoe-drawer --></div><div id="nexmoe-content"><div class="nexmoe-primary"><div class="nexmoe-post">
  <article>
    
        <div class="nexmoe-post-cover absolute" style="padding-top: NaN%;"> 
            <img src="https://pi.loili.com/2023/edbdbb805891eaf1b17904c2d56cd98c.png" alt="Vite 使用 br 压缩" loading="lazy">
            <h1>Vite 使用 br 压缩</h1>
        </div>
    
    
    <div class="nexmoe-post-meta">
    <div class="nexmoe-rainbow">
        <a class="nexmoefont icon-calendar-fill">2023年06月24日</a>
        
            <a class="nexmoefont icon-appstore-fill -link" href="/categories/Vite/">Vite</a><a class="nexmoefont icon-appstore-fill -link" href="/categories/Vite/%E5%89%8D%E7%AB%AF/">前端</a>
        
        
    </div>
    
    
    
    
    
</div>

    <h2 id="为什么使用-br-压缩"><a href="#为什么使用-br-压缩" class="headerlink" title="为什么使用 br 压缩"></a>为什么使用 br 压缩</h2><ul>
<li><h3 id="gzip-压缩"><a href="#gzip-压缩" class="headerlink" title="gzip 压缩"></a>gzip 压缩</h3><p>Gzip 是一种用于文件压缩与解压缩的文件格式。它基于 Deflate 算法，可将文件（译者注：快速地、流式地）压缩地更小，从而实现更快的网络传输。Web 服务器与现代浏览器普遍地支持 Gzip，这意味着服务器可以在发送文件之前自动使用 Gzip 压缩文件，而浏览器可以在接收文件时自行解压缩文件。<br>摘自：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/GZip_compression">MDN Web Docs</a></p>
</li>
<li><h3 id="br-压缩"><a href="#br-压缩" class="headerlink" title="br 压缩"></a>br 压缩</h3><p>同 gzip 类似， Brotli 也是一种压缩算法，由 Google 开发，对于文本压缩非常好。主要的特点就是它在服务器端和客户端都用到了词典，常见关键词和词组都有，这样可以获得更佳的压缩率。但 brotli 压缩速度比 Gzip 压缩慢，因此 gzip 可能更适合于压缩不可缓存的内容。</p>
<p>目前 Brotli已经获得各主流浏览器的支持。</p>
</li>
<li><h3 id="gzip-与-br-压缩率对比"><a href="#gzip-与-br-压缩率对比" class="headerlink" title="gzip 与 br 压缩率对比"></a>gzip 与 br 压缩率对比</h3><p>根据某些文章的比较：</p>
<p>JavaScript 文件用 Brotli 压缩可以比 gzip 的小 14%。<br>HTML 文件会小 21%。<br>CSS 文件会小 17%</p>
<p>参考：<a target="_blank" rel="noopener" href="https://seo.g2soft.net/2019/05/22/brotli-vs-gzip.html">Brotli 压缩同 Gzip 压缩之比较</a></p>
</li>
<li><h3 id="br-压缩的兼容性"><a href="#br-压缩的兼容性" class="headerlink" title="br 压缩的兼容性"></a>br 压缩的兼容性</h3><p>目前，br 压缩的兼容性并不是很好，但是随着时间的推移，br 压缩的兼容性会越来越好。具体兼容性表，请参见：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://caniuse.com/?search=brotli">Can I use brotli</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Encoding#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7">MDN Web Docs</a></li>
</ul>
<p>除了浏览器的兼容性，还需要考虑服务器的兼容性，目前，nginx 1.16.0 以上版本支持 br 压缩，apache 2.4.26 以上版本支持 br 压缩。</p>
</li>
</ul>
<h2 id="Vite-使用-br-压缩-（vite-plugin-compression）"><a href="#Vite-使用-br-压缩-（vite-plugin-compression）" class="headerlink" title="Vite 使用 br 压缩 （vite-plugin-compression）"></a>Vite 使用 br 压缩 （vite-plugin-compression）</h2><h3 id="1-安装插件"><a href="#1-安装插件" class="headerlink" title="1. 安装插件"></a>1. 安装插件</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i <span class="token parameter variable">-D</span> vite-plugin-compression<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-配置-vite-config-ts"><a href="#2-配置-vite-config-ts" class="headerlink" title="2. 配置 vite.config.ts"></a>2. 配置 vite.config.ts</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> viteCompression <span class="token keyword">from</span> <span class="token string">'vite-plugin-compression'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 其他插件</span>
    <span class="token function">viteCompression</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      verbose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      disable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      threshold<span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
      algorithm<span class="token operator">:</span> <span class="token string">'brotliCompress'</span><span class="token punctuation">,</span>
      ext<span class="token operator">:</span> <span class="token string">'.br'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Vite-开启-br-压缩-（rollup-plugin-brotli）"><a href="#Vite-开启-br-压缩-（rollup-plugin-brotli）" class="headerlink" title="Vite 开启 br 压缩 （rollup-plugin-brotli）"></a>Vite 开启 br 压缩 （rollup-plugin-brotli）</h2><h3 id="1-安装插件-1"><a href="#1-安装插件-1" class="headerlink" title="1. 安装插件"></a>1. 安装插件</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i <span class="token parameter variable">-D</span> rollup-plugin-brotli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-配置-vite-config-ts-1"><a href="#2-配置-vite-config-ts-1" class="headerlink" title="2. 配置 vite.config.ts"></a>2. 配置 vite.config.ts</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> brotli <span class="token keyword">from</span> <span class="token string">'rollup-plugin-brotli'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 其他插件</span>
    <span class="token function">brotli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Apache-开启-br-压缩"><a href="#Apache-开启-br-压缩" class="headerlink" title="Apache 开启 br 压缩"></a>Apache 开启 br 压缩</h2><h3 id="1-安装-brotli-模块"><a href="#1-安装-brotli-模块" class="headerlink" title="1. 安装 brotli 模块"></a>1. 安装 brotli 模块</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> brotli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-配置-Apache"><a href="#2-配置-Apache" class="headerlink" title="2. 配置 Apache"></a>2. 配置 Apache</h3><ul>
<li><p>安装 brotli 模块</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> brotli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>配置 Apache</p>
<p>使用下面命令在 Apache 配置文件中启用 brotli 模块</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> a2enmod brotli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>之后，通过在虚拟主机配置文件中添加以下行来启用 brotli 压缩：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>IfModule mod_brotli.c<span class="token operator">&gt;</span>
  AddOutputFilterByType BROTLI_COMPRESS text/html text/plain text/xml text/css text/javascript application/javascript application/x-javascript application/json application/xml application/rss+xml image/svg+xml
<span class="token operator">&lt;</span>/IfModule<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>保存文件并重新启动 Apache 服务器：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> apache2 restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><span id="verify-md">验证 Apache 是否开启 br 压缩</span></p>
<p>使用下面命令验证 Apache 是否开启 br 压缩</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-I</span> <span class="token parameter variable">-H</span> <span class="token string">'Accept-Encoding: br'</span> http://your-domain.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果开启了 br 压缩，则会在返回信息中看到如下行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Content-Encoding: br<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>除了上面的方法，还可以参考如下教程：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Parhoia/article/details/102753430">Apache压缩</a></p>
</li>
</ul>
<h2 id="Nginx-开启-br-压缩"><a href="#Nginx-开启-br-压缩" class="headerlink" title="Nginx 开启 br 压缩"></a>Nginx 开启 br 压缩</h2><h3 id="下载-Brotli-的源码；"><a href="#下载-Brotli-的源码；" class="headerlink" title="下载 Brotli 的源码；"></a>下载 Brotli 的源码；</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token function">git</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> /usr/local/src

<span class="token function">git</span> clone https://github.com/google/ngx_brotli.git
<span class="token function">pushd</span> ngx_brotli
<span class="token function">git</span> submodule update <span class="token parameter variable">--init</span>
<span class="token function">popd</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="执行命令-nginx-V，configure-arguments-即为现有的参数；"><a href="#执行命令-nginx-V，configure-arguments-即为现有的参数；" class="headerlink" title="执行命令 nginx -V，configure arguments 即为现有的参数；"></a>执行命令 <code>nginx -V</code>，<code>configure arguments</code> 即为现有的参数；</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nginx version: nginx/1.16.1
built by gcc <span class="token number">4.8</span>.5 <span class="token number">20150623</span> <span class="token punctuation">(</span>Red Hat <span class="token number">4.8</span>.5-36<span class="token punctuation">)</span> <span class="token punctuation">(</span>GCC<span class="token punctuation">)</span> 
built with OpenSSL <span class="token number">1.1</span>.1c  <span class="token number">28</span> May <span class="token number">2019</span>
TLS SNI support enabled
configure arguments: --with-http_ssl_module --with-http_v2_module --with-http_sub_module --with-openssl<span class="token operator">=</span><span class="token punctuation">..</span>/openssl-1.1.1c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="追加参数-add-module-ngx-brotli，重新编译-Nginx。本文中-Nginx-的源码目录是-usr-local-src-nginx-1-16-1；"><a href="#追加参数-add-module-ngx-brotli，重新编译-Nginx。本文中-Nginx-的源码目录是-usr-local-src-nginx-1-16-1；" class="headerlink" title="追加参数 --add-module=../ngx_brotli，重新编译 Nginx。本文中 Nginx 的源码目录是 /usr/local/src/nginx-1.16.1；"></a>追加参数 <code>--add-module=../ngx_brotli</code>，重新编译 Nginx。本文中 Nginx 的源码目录是 <code>/usr/local/src/nginx-1.16.1</code>；</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> nginx-1.16.1
./configure <span class="token punctuation">\</span>
--with-http_ssl_module <span class="token punctuation">\</span>
--with-http_v2_module <span class="token punctuation">\</span>
--with-http_sub_module <span class="token punctuation">\</span>
--with-openssl<span class="token operator">=</span><span class="token punctuation">..</span>/openssl-1.1.1c <span class="token punctuation">\</span>
--add-module<span class="token operator">=</span><span class="token punctuation">..</span>/ngx_brotli
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如需执行平滑升级 (热部署)，make 之后请不要 make install：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.old
<span class="token function">cp</span> objs/nginx /usr/local/nginx/sbin/nginx
<span class="token function">make</span> upgrade<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="接着修改-nginx-conf-默认值就够用。不妨再留意一下-gzip-types-和-brotli-types-指令，以允许压缩-text-html-以外的文件，MIME-类型列表见-；"><a href="#接着修改-nginx-conf-默认值就够用。不妨再留意一下-gzip-types-和-brotli-types-指令，以允许压缩-text-html-以外的文件，MIME-类型列表见-；" class="headerlink" title="接着修改 nginx.conf (默认值就够用。不妨再留意一下 gzip_types 和 brotli_types 指令，以允许压缩 text/html 以外的文件，MIME 类型列表见)；"></a>接着修改 <code>nginx.conf</code> (默认值就够用。不妨再留意一下 <code>gzip_types</code> 和 <code>brotli_types</code> 指令，以允许压缩 <code>text/html</code> 以外的文件，MIME 类型列表见)；</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">http <span class="token punctuation">{</span>
    <span class="token punctuation">..</span>.
    <span class="token function">gzip</span> on<span class="token punctuation">;</span>
    brotli on<span class="token punctuation">;</span>
    
    <span class="token comment"># gzip_types text/css text/javascript application/rss+xml;</span>
    <span class="token comment"># brotli_types text/css text/javascript application/rss+xml;</span>
    <span class="token punctuation">..</span>.
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="重载-Nginx，检验效果。"><a href="#重载-Nginx，检验效果。" class="headerlink" title="重载 Nginx，检验效果。"></a>重载 Nginx，检验效果。</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nginx <span class="token parameter variable">-t</span> <span class="token operator">&amp;&amp;</span> nginx <span class="token parameter variable">-s</span> reload<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可以参考上文 <a href="#verify-md">验证 Apache 是否开启 br 压缩</a><br>也可以可借由 Brotli Test 等工具，或者 Chrome DevTools 的 Network 面板，查看响应头中的 Content-Encoding 字段。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    
  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>本文作者：</strong>别调P<br>
        <strong>本文链接：</strong><a href="https://blog.bietiaop.com/2023/06/24/web/front/vite/vite-shi-yong-br-ya-suo/" title="https:&#x2F;&#x2F;blog.bietiaop.com&#x2F;2023&#x2F;06&#x2F;24&#x2F;web&#x2F;front&#x2F;vite&#x2F;vite-shi-yong-br-ya-suo&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;blog.bietiaop.com&#x2F;2023&#x2F;06&#x2F;24&#x2F;web&#x2F;front&#x2F;vite&#x2F;vite-shi-yong-br-ya-suo&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
   
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Vite/" rel="tag">Vite</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Vite%E6%8F%92%E4%BB%B6/" rel="tag">Vite插件</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/br/" rel="tag">br</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/gzip/" rel="tag">gzip</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/%E5%8E%8B%E7%BC%A9/" rel="tag">压缩</a>
    
</div>
  
  
    <script async src="/js/copy-codeblock.js?v=1730173442596"></script>
  

  
      <div class="nexmoe-post-footer">
          <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<div id="vcomments">
  正在努力加载评论
</div>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'q3wFidkEgse9PfmKDYl9XugD-gzGzoHsz',
        appKey: 'SvOMchDSYmvR50to670gIrzE',
        placeholder: '留下你的足迹...',
        enableQQ: true
    })
</script>

      </div>
  
</div></div><div class="nexmoe-post-right">    <div class="nexmoe-fixed">
        <div class="nexmoe-tool">

            

            
            
            <button class="mdui-fab catalog" style="overflow:unset;">
                <i class="nexmoefont icon-i-catalog"></i>
                <div class="nexmoe-toc">
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-br-%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.</span> <span class="toc-text">为什么使用 br 压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gzip-%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.1.</span> <span class="toc-text">gzip 压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#br-%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.2.</span> <span class="toc-text">br 压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gzip-%E4%B8%8E-br-%E5%8E%8B%E7%BC%A9%E7%8E%87%E5%AF%B9%E6%AF%94"><span class="toc-number">1.3.</span> <span class="toc-text">gzip 与 br 压缩率对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#br-%E5%8E%8B%E7%BC%A9%E7%9A%84%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="toc-number">1.4.</span> <span class="toc-text">br 压缩的兼容性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vite-%E4%BD%BF%E7%94%A8-br-%E5%8E%8B%E7%BC%A9-%EF%BC%88vite-plugin-compression%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">Vite 使用 br 压缩 （vite-plugin-compression）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">1. 安装插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE-vite-config-ts"><span class="toc-number">2.2.</span> <span class="toc-text">2. 配置 vite.config.ts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vite-%E5%BC%80%E5%90%AF-br-%E5%8E%8B%E7%BC%A9-%EF%BC%88rollup-plugin-brotli%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">Vite 开启 br 压缩 （rollup-plugin-brotli）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6-1"><span class="toc-number">3.1.</span> <span class="toc-text">1. 安装插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE-vite-config-ts-1"><span class="toc-number">3.2.</span> <span class="toc-text">2. 配置 vite.config.ts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-%E5%BC%80%E5%90%AF-br-%E5%8E%8B%E7%BC%A9"><span class="toc-number">4.</span> <span class="toc-text">Apache 开启 br 压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85-brotli-%E6%A8%A1%E5%9D%97"><span class="toc-number">4.1.</span> <span class="toc-text">1. 安装 brotli 模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE-Apache"><span class="toc-number">4.2.</span> <span class="toc-text">2. 配置 Apache</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-%E5%BC%80%E5%90%AF-br-%E5%8E%8B%E7%BC%A9"><span class="toc-number">5.</span> <span class="toc-text">Nginx 开启 br 压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD-Brotli-%E7%9A%84%E6%BA%90%E7%A0%81%EF%BC%9B"><span class="toc-number">5.1.</span> <span class="toc-text">下载 Brotli 的源码；</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4-nginx-V%EF%BC%8Cconfigure-arguments-%E5%8D%B3%E4%B8%BA%E7%8E%B0%E6%9C%89%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%9B"><span class="toc-number">5.2.</span> <span class="toc-text">执行命令 nginx -V，configure arguments 即为现有的参数；</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%BD%E5%8A%A0%E5%8F%82%E6%95%B0-add-module-ngx-brotli%EF%BC%8C%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91-Nginx%E3%80%82%E6%9C%AC%E6%96%87%E4%B8%AD-Nginx-%E7%9A%84%E6%BA%90%E7%A0%81%E7%9B%AE%E5%BD%95%E6%98%AF-usr-local-src-nginx-1-16-1%EF%BC%9B"><span class="toc-number">5.3.</span> <span class="toc-text">追加参数 --add-module&#x3D;..&#x2F;ngx_brotli，重新编译 Nginx。本文中 Nginx 的源码目录是 &#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx-1.16.1；</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E7%9D%80%E4%BF%AE%E6%94%B9-nginx-conf-%E9%BB%98%E8%AE%A4%E5%80%BC%E5%B0%B1%E5%A4%9F%E7%94%A8%E3%80%82%E4%B8%8D%E5%A6%A8%E5%86%8D%E7%95%99%E6%84%8F%E4%B8%80%E4%B8%8B-gzip-types-%E5%92%8C-brotli-types-%E6%8C%87%E4%BB%A4%EF%BC%8C%E4%BB%A5%E5%85%81%E8%AE%B8%E5%8E%8B%E7%BC%A9-text-html-%E4%BB%A5%E5%A4%96%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8CMIME-%E7%B1%BB%E5%9E%8B%E5%88%97%E8%A1%A8%E8%A7%81-%EF%BC%9B"><span class="toc-number">5.4.</span> <span class="toc-text">接着修改 nginx.conf (默认值就够用。不妨再留意一下 gzip_types 和 brotli_types 指令，以允许压缩 text&#x2F;html 以外的文件，MIME 类型列表见)；</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD-Nginx%EF%BC%8C%E6%A3%80%E9%AA%8C%E6%95%88%E6%9E%9C%E3%80%82"><span class="toc-number">5.5.</span> <span class="toc-text">重载 Nginx，检验效果。</span></a></li></ol></li></ol>
                </div>
            </button>
            

            

            <a href="#nexmoe-content" class="backtop toc-link" aria-label="Back To Top" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
        </div>
    </div>
</div></div><div id="nexmoe-footer"><!--!--></div><div id="nexmoe-search-space"><div class="search-container"><div class="search-header"><div class="search-input-container"><input class="search-input" type="text" placeholder="搜索" onInput="sinput();"></div><a class="search-close" onclick="sclose();">×</a></div><div class="search-body"></div></div></div><div><script src="/prism.js"></script>
</div>
        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        const hasAttr = (e,a) => a.some(_=> e.attr(_)!==undefined);
        $('a').each(function() {
          const $this = $(this);
          if(hasAttr($this,["data-fancybox","ignore-external-link"])) return;
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== '' || window.location.host) {
                    $this.attr('href', '/go.html?u='+href+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script></body></html>